# FamilyPact (家庭公约) 🏠✨

> 一个极简、优雅的家庭任务与积分管理系统，采用 iOS 原生设计美学。

FamilyPact 旨在帮助家庭建立健康的日常习惯，通过可视化的积分系统鼓励孩子完成生活、学习和劳动任务。它拥有媲美原生 iOS 应用的流畅体验和精致 UI。

## ✨ 核心特性

- **🍎 iOS 极致美学**: 深度复刻 iOS 设计语言，包含毛玻璃特效、平滑动画、触觉反馈和黑暗模式。
- **📝 多维任务管理**:
  - **生活 (Living)**: 运动、早起、用餐习惯等。
  - **学习 (Learning)**: 作业、奥数、阅读、英语等。
  - **劳动 (Labor)**: 家务分担、整理收纳。
- **💬 家庭交流中心 (NEW)**:
  - **公共公告**: 家长可发布全家可见的通知。
  - **私密留言**: 孩子与父母之间的 1-on-1 悄悄话，支持隐私隔离（爸爸看不见孩子给妈妈的留言）。
  - **管理权限**: 家长支持单条消息删除及一键清空。
  - **智能时间**: 自动识别当天消息，带有时钟图标的温馨日期提示。
- **🏆 积分与奖励系统**:
  - **星星嘉奖**: 家长可为出色表现授予“嘉奖星星”，伴随 3D 卡片庆祝动效。
  - **撤销机制**: 完善的撤销逻辑，支持当日星星回滚及当日记录全面重置（后悔药）。
  - **时间券兑换**: 积分自动兑换平板使用时间券。
- **🔒 权限与安全**: 基于 PIN 码的家长模式，支持身份快速切换。
- **🔥 浮动分奖励 (NEW)**: 学习任务引入“新鲜感奖励”，昨日未做项目今日完成可获 1.5 倍积分，鼓励多维尝试。
- **📊 趋势分析**: 周数据可视化图表，追踪成长点滴。

## 🛠️ 技术栈

- **前端**: 原生 HTML5, CSS3, Vanilla JavaScript (ES6+)。
- **存储与 API**: Neon (Serverless Postgres) + Cloudflare Workers。
- **部署**: [Cloudflare Pages](https://pages.cloudflare.com/)。
- **架构**: 零框架依赖，毫秒级加载。

## 🚀 快速开始

1. **环境**: 安装 Node.js 和 Wrangler。
2. **开发**: `npx wrangler pages dev .`
3. **部署**: `npx wrangler pages deploy .`

## 📱 界面设计 (UI Design)

> 下方展示应用的主要功能模块线框图。

### 🏠 Tab A: 生活与习惯 (Life)

核心功能：基础作息打卡与多维习惯养成。

```text
+-----------------------------+
|  FamilyPact      12月12日   | <--- 顶部状态栏
|  [ 🌞 农历十一月十二 ]       |
+-----------------------------+
|    [ 仪表盘 Dashboard ]     |
|  125 / 140 PTS    0 min     |
|  [🔒 未解锁]   [进度条...]   |
+-----------------------------+
| 🏃 运动小健将 (Sport Hub)   |
| [●] [●] [○] [○] [○]  +40pts | 
|  已完成 2 组 (每组30分钟)    |
+-----------------------------+
| 🍱 吃饭快快星人 (25min)     |
| [●] [●] [●] (剩15分)   [···]| <--- 减分制
+-----------------------------+
| 🤫 文明小标兵 (不讲脏话)    |
| [-]  0  [+] (剩10分)   [···]| <--- 计数器
+-----------------------------+
| 🐣 早起小鸟 (8:30前)        |
|           [ ✅ 已完成 ]     |
+-----------------------------+
```

### 📚 Tab C: 学习与课程 (Study)

核心功能：课外班管理与校内作业追踪。

```text
+-----------------------------+
| 🎓 课外小课程 (Course Hub)  |
| +-------+ +-------+ +-----+ |
| |新东方 | | 口才  | |练声 | |
| | +40   | | +15   | | +15 | |
| |  ✅   | |  🔲   | |  🔲 | |
| +-------+ +-------+ +-----+ |
+-----------------------------+
| 每日任务池 (任选 4 项)      |
|           [ 进度 2/4 ]      |
+-----------------------------+
| 📺 英语阅读+观影 (20min)    |
| [必做]    [ ✅ 已完成 ]     |
+-----------------------------+
| 📝 作业通关 (每天2页)       |
|           [ ✅ 已完成 ]     |
+-----------------------------+
| 📖 语文探险家 (阅读)        |
|           [ 🔲 未完成 ]     |
+-----------------------------+
```

### 🧹 Tab B: 劳动与贡献 (Labor)

核心功能：家务细分与额外奖励机制。

```text
+-----------------------------+
| 🍽️ 餐桌小助手 (必做)        |
| (分项打钩)                  |
| [拿碗筷] [收碗筷] [桌面清理]|
+-----------------------------+
| 🧹 全能家务王 (额外奖励)    |
| (多选加分)                  |
| [扫地] [倒垃圾] [洗碗] ...  |
+-----------------------------+
| 📢 暖心小广播 (叫爷爷)      |
| [●] [○] (2次/天)       [···]|
+-----------------------------+
```

### 👤 Tab D: 我的与设置 (Mine)

核心功能：个人状态、奖券兑换与管理员工具。

```text
+-----------------------------+
| [ 👤 头像 ]  用户名称       |
| 角色: 管理者 / 执行者       |
+-----------------------------+
| 🎫 娱乐时间券 (30min/张)    |
| [✅已用] [🎫可用] [🔒锁定]  |
| [🔒锁定] [🔒锁定] [🔒锁定]  |
+-----------------------------+
| ⚙️ 设置列表                 |
| [ 设置 PIN 码            > ]|
| [ 家庭码: 123456         > ]|
+-----------------------------+
| 🛡️ 管理员工具 (仅家长)      |
| [ ✨ 授予嘉奖星星        > ]|
| [ ↺ 撤销今日星星         > ]|
| [ ⚠️ 重置今日记录         > ]|
+-----------------------------+
```

### 📊 Tab E: 趋势分析 (Trends)

核心功能：周数据可视化与历史回溯。

```text
+-----------------------------+
| [周一 12] [周二 13] [周三 14]| <--- 日期切换胶囊
+-----------------------------+
|        周趋势分析           |
|   本周平均分: 158 PTS       |
|   (较上周提升 12%)          |
+-----------------------------+
|      [柱状图区域]           |
|  |   |   |   |   |   |      |
|  |   |   | ▄ |   |   |      |
|  ▄   ▄   ▄ █ ▄   ▄   ▄      |
| Mon Tue Wed Thu Fri Sat Sun |
+-----------------------------+
| 📜 每日明细                 |
| 12-12  ✅ 达标   160 PTS    |
| 12-11  ❌ 未达标 110 PTS    |
+-----------------------------+
```

### 💬 Tab F: 家庭交流 (Chat)

核心功能：家庭内部私密留言与公告。

```text
+-----------------------------+
| [📢 公告] 今晚出去吃饭!     |
|            -- 爸爸 10:00AM  |
+-----------------------------+
| [👶 儿子]                   |
| 妈妈，我想吃红烧肉~         |
|                     12:30PM |
+-----------------------------+
|                  [👩 妈妈] |
|              好的，晚上做!  |
|                     12:35PM |
+-----------------------------+
| [ 输入框... ]  [ 发送 ]     |
+-----------------------------+
```

## 📂 项目结构

```
FamilyPact/
├── chat.js         # 交流中心核心逻辑
├── main.js         # 仪表盘、任务与全局系统逻辑
├── style.css       # iOS 设计系统 (含 2000+ 行精心雕琢的样式)
├── data.js         # 任务与奖励配置
├── functions/      # 后端 API (Messages, Logs, Sessions, Auth)
└── index.html      # 页面入口
```

## 📄 更新日志 (根据 Commits)

- **v1.3.0**: 逻辑优化：学习任务规则升级为“任选 4 项”；引入“浮动分”动态奖励机制；支持本地连接 Neon 数据库调试。
- **v1.2.0**: 强化交流中心：新增单条删除、公告默认首选、隐私隔离、智能日期。
- **v1.1.5**: 强化逻辑：新增嘉奖星星撤销功能及当日记录全面重置。
- **v1.1.0**: 3D 庆祝系统：授予星星时弹出精致动效。
- **v1.0.0**: iOS 设计风格重构完成，任务系统上线。

## 🚀 后续优化计划 (Backlog)

- [ ] **UI 规则配置**: 支持在家长设置界面直接通过 UI 修改“任选 N 项”数值，无需修改代码。
- [ ] **多端同步优化**: 进一步优化离线状态下的数据冲突处理逻辑。
- [ ] **周报自动生成**: 每周日晚自动推送整周表现分析摘要。

## 📄 许可证

MIT License
