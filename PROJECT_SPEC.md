# FamilyPact 项目官方白皮书 (2026.01.29 版)

## 1. 项目定位

**FamilyPact** 是一款基于 iOS 极简美学的家庭积分管理应用。通过游戏化的勋章与奖券机制，培养孩子的自我管理能力、家务责任感与学习动力。

---

## 2. 核心技术架构

- **前端**：Vanilla JS + CSS (iOS 设计语言) + HTML5。
- **后端**：Cloudflare Workers (Functions) 处理 API 请求。
- **数据库**：Neon (PostgreSQL) 实现全量数据持久化。
- **同步**：实时云同步，支持多设备（家长手机/孩子平板）数据瞬间对齐。

---

## 3. 角色与权限系统

系统实行严格的 **“权限非对称”** 设计：

- **管理者 (Parent)**：
  - 拥有“最终解释权”。
  - 可双向修改分数、增减计数器、勾选/反勾选任务。
  - **核销/恢复** 娱乐时间券。
  - 切换“有课日”状态，一键“重置当日记录”。
- **执行者 (Child)**：
  - **单向递增原则**：只能勾选完成动作，不能取消；只能增加计数，不能减少。
  - **奖券核销权**：可以**自主核销**已获得的娱乐时间券（一旦消耗，不可自行恢复）。
  - **防作弊**：无法修改过期日期的记录，无法恢复已使用的奖券。

---

## 4. 积分与奖励逻辑

### 4.1 计分规则

- **起步分**：140 积分（基础+必做项）。
- **判定条件**：所有“必做项 (Required)”必须全部标绿，否则无法解锁奖励。
- **有课日 (Has Class)**：
  - 周一至周五：默认开启。包含“课外补习 (+20分)”项，目标更具挑战。
  - 周末：默认关闭。自动扣除补习分。

### 4.2 扣分逻辑分类 (Deduction Types)

系统将所有负向激励分为两类，均显示为 **蓝色**：

1. **守分型 (Initial-Point Penalty)**:
    - **逻辑**: 开局即获得满分（如“早起小鸟”初始 10 分），若发生提醒则从该项分数中扣除。
    - **UI 显示**: 采用“保护机制”话术，如：`剩 10 分 (初始 10)`。分值满分时为**绿色**，被扣分后变为**红色**，增强心理暗示。
    - **典型项目**: 🌅 元气生活板块中的饮食习惯、常规生活提醒。
2. **惩罚型 (Accumulative Penalty)**:
    - **逻辑**: 初始分位 0，每发生一次行为，就从**总分**中额外扣除分值（如“拒绝拖延”每次扣 10 分）。
    - **UI 显示**: 采用“风险提示”话术。初始显示 `做错扣：-10 / 次`。一旦犯错记录，显示为红色 `已扣分：-10`。
    - **典型项目**: 严重行为规范违规 (行为红线)、超时罚分。

### 4.3 颜色语义 (Color Semantics)

- **🟧 琥珀/橙色**：必做项 (Required) 或 核心加分项。
- **🟦 极简蓝**：倒扣型项目 (Deductions)，如提醒次数、搞名堂、超时罚分。
- **⬛️ 深空黑**：基础可选任务。

### 4.3 娱乐时间券 (Time Slot)

- **解锁阈值**：
  - 140 积分 = 1 张券 (30min)。
  - 每额外 20 积分 = 再加 1 张券 (+30min)。
- **既得利益保护**：积分减少（被扣分）不会导致**已核销**的奖券消失。
- **操作闭环**：家长和孩子均可点击“🎫 30”核销（消耗）；仅家长可点击“✅ 已消耗”进行恢复。

### 4.4 特别嘉奖星星 (Special Stars) ✨

- **机制**：家长可随时点击“嘉奖”按钮并填写寄语，手动发放星星。
- **分值**：**1 颗星星 = 10 积分**。星星积分直接计入总分，可辅助解锁奖券。
- **展示**：孩子端收到星星时会有全屏粒子特效及 3D 寄语卡片展示，Dashboard 同步显示 ✨ 数量。

---

## 5. 核心页面分布

1. **🌅 元气生活 (A)**：起床小鸟、快快星人、文明小标兵、坐姿标杆。
2. **🏠 家庭小主人 (B)**：餐桌小助手 (必做项) 与 全能家务王 (阶梯加分)。
3. **🧠 智慧大闯关 (C)**：作业通关、脑力大风暴、语文探险家、小小程序员。
4. **💪 活力加油站 (D)**：运动小健将、系统仪表盘、时间券管理、PIN 码设置。
5. **📊 趋势分析 (E)**：查看历史周数据与达成规律。

---

## 6. 数据库 Schema (daily_logs)

| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| **user_id** | INTEGER | 执行者 ID |
| **date** | DATE | 日期 (YYYY-MM-DD) |
| **answers** | JSONB | 具体的打卡状态 (ID: Value) |
| **total_score** | INTEGER | 最终总得分 |
| **has_class** | BOOLEAN | 是否为有课日 |
| **used_slots** | INTEGER | 已核销的时间券数量 |

---

## 7. 后续开发指导

1. **数据安全**：当前 PIN 码为本地前端校验，未来可考虑移至 Workers 后端增强安全性。
2. **多子支持**：目前已支持多孩子切换，未来可增加孩子间的“竞赛周报”。
3. **成就奖章**：当连续 7 天总分超过 200 分时，自动弹窗发放“全能之星”勋章。
4. **离线支持**：增加 Service Worker 实现弱网下的数据暂存与自动重连同步。

---
**FamilyPact - 陪伴，但不只是监督。**
